= form_for @car do |f|
  - if @car.errors.any?
    #error_explanation
      %h2= "#{pluralize(@car.errors.count, "error")} prohibited this car from being saved:"
      %ul
        - @car.errors.full_messages.each do |msg|
          %li= msg

  .field
    = f.label :mileage
    = f.text_field :mileage
  .field
    = f.label :numberplate
    = f.text_field :numberplate

  .field
    = f.label :car_model
    = f.collection_select(:car_model_id, CarModel.all, :id, :name)

  .field
    = f.label :car_type
    = f.collection_select(:car_type_id, CarType.all, :id, :name)
  
  .field
    = f.label :device
    - if @car.has_device?
      = list_devices_with_default(@car.device)
    - else
      - if no_available_devices? 
        = list_no_available_devices
      - else 
        = list_available_devices

  .field
    = f.label :driver
    - if @car.has_driver?
      = list_drivers_with_default(@car.driver)
    - else
      - if no_available_drivers? 
        = list_no_available_drivers
      - else 
        = list_available_drivers

  .field
    = f.label :registration_no
    = f.text_field :registration_no
  .field
    = f.label :year
    = f.text_field :year
  .field
    = f.label :color
    = f.text_field :color

  .field
    = f.label :group
    = f.collection_select(:group_id, Group.all, :id, :name)

  %h2 Alarms
  = f.select :alarm_ids, Alarm.all.collect {|x| [x.name, x.id]}, {}, :multiple => true

  %h2 Alarms
  = f.label :work_schedule_id, "Work Schedule"
  = f.collection_select(:work_schedule_id, WorkSchedule.all, :id, :name)


  %br
  %br
  %br

  .actions
    = f.submit 'Save'
